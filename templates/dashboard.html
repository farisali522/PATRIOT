{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Dashboard - PATRIOT{% endblock %}

{% block body_class %}has-sidebar{% endblock %}

{% block sidebar %}
{% include 'layouts/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- alert info standar -->
    <div class="alert alert-info alert-dismissible fade show border-0 shadow-sm mb-4" role="alert">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-2"></i>
            <div>
                Selamat Datang, <strong>FARIS GERINDRA</strong> (DIGITAL COMMAND OFFICER).
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Stats Cards -->
    <!-- Section Info -->
    <div class="mb-3">
        <h6 class="fw-bold text-maroon text-uppercase mb-0" style="letter-spacing: 1px; font-size: 12px;">
            {% if request.session.active_role == 'COMMANDER' %}
            Commander Command Center
            {% elif request.session.active_role == 'CADRE' %}
            Cadre Mission Hub
            {% else %}
            Dashboard DCO
            {% endif %}
        </h6>
    </div>
    <div class="row g-4 mb-4">
        {% if request.session.active_role == 'DCO' or not request.session.active_role %}
        <!-- VIEW DCO -->
        <!-- Total Konten + Rincian -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <div>
                            <p class="text-muted fw-bold mb-1 small text-uppercase ls-1">Total Konten</p>
                            <h4 class="fw-bold text-dark mb-0 bg-white p-1 rounded">{{ total_konten|default:"0" }}</h4>
                        </div>
                        <div class="icon-box bg-maroon-soft text-maroon rounded-circle p-2 d-flex align-items-center justify-content-center"
                            style="width: 45px; height: 45px;">
                            <i class="fas fa-layer-group"></i>
                        </div>
                    </div>

                    <!-- Rincian Platform -->
                    <div class="d-flex gap-2 mb-4">
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1 border shadow-sm">
                            <i class="fab fa-instagram text-danger me-2 small"></i>
                            <span class="fw-bold text-dark small">{{ total_ig|default:"0" }}</span>
                        </div>
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1 border shadow-sm">
                            <i class="fab fa-tiktok text-dark me-2 small"></i>
                            <span class="fw-bold text-dark small">{{ total_tt|default:"0" }}</span>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                        <span class="badge bg-success-soft text-success rounded-pill px-2 py-1" style="font-size: 0.65rem;">
                            <i class="fas fa-arrow-up me-1"></i> Update
                        </span>
                        <a href="{% url 'daftar_konten' %}" class="btn btn-sm btn-outline-maroon rounded-pill px-3"
                            style="font-size: 0.7rem;">
                            Kelola Konten <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Operasi Harian -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <p class="text-muted fw-bold mb-1 small text-uppercase ls-1" style="font-size: 0.65rem;">Status Operasi</p>
                            <h7 class="fw-bold text-maroon mb-0">
                                <i class="far fa-calendar-alt me-2"></i>{{ today|date:"d F Y" }}
                            </h7>
                        </div>
                        <div class="icon-box bg-primary-soft text-primary rounded-circle p-2" style="width: 45px; height: 45px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-bullseye"></i>
                        </div>
                    </div>

                    <div class="border-top pt-3">
                        <h6 class="small fw-bold text-secondary mb-2" style="font-size: 0.7rem;">TUGAS AKTIF HARI INI:</h6>

                        <div class="d-flex flex-column gap-2" style="max-height: 120px; overflow-y: auto;">
                            {% for tugas in tugas_aktif_list %}
                            <div class="d-flex align-items-center bg-light p-2 rounded border">
                                <div class="me-2">
                                    {% if tugas.konten.platform == 'INSTAGRAM' %}
                                    <i class="fab fa-instagram text-danger small"></i>
                                    {% elif tugas.konten.platform == 'TIKTOK' %}
                                    <i class="fab fa-tiktok text-dark small"></i>
                                    {% else %}
                                    <i class="fas fa-share-alt text-secondary small"></i>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1 text-truncate">
                                    <span class="small fw-bold text-dark d-block text-truncate mb-1" style="font-size: 0.75rem;">
                                        {{ tugas.konten.judul }}</span>
                                    <div class="d-flex flex-wrap gap-1 mb-1">
                                        {% if tugas.is_like %}<span class="badge bg-danger rounded-pill" style="font-size: 0.55rem;">Like</span>{% endif %}
                                        {% if tugas.is_komen %}<span class="badge bg-primary rounded-pill" style="font-size: 0.55rem;">Komen</span>{% endif %}
                                        {% if tugas.is_share %}<span class="badge bg-success rounded-pill" style="font-size: 0.55rem;">Share</span>{% endif %}
                                        {% if tugas.is_follow %}<span class="badge bg-info text-dark rounded-pill" style="font-size: 0.55rem;">Follow</span>{% endif %}
                                        {% if tugas.is_reply %}<span class="badge bg-secondary rounded-pill" style="font-size: 0.55rem;">Reply</span>{% endif %}
                                    </div>
                                    {% if tugas.instruksi %}
                                    <small class="text-muted d-block text-truncate italic" style="font-size: 0.6rem;">
                                        <i class="fas fa-info-circle me-1"></i>{{ tugas.instruksi }}
                                    </small>
                                    {% endif %}
                                </div>
                                <div class="ms-2">
                                    <small class="text-secondary" style="font-size: 0.65rem;">
                                        Exp: {{ tugas.tanggal_selesai|date:"d/m" }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-2 text-muted border border-dashed rounded bg-light">
                                <small style="font-size: 0.7rem;">Tidak ada misi aktif hari ini.</small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-end align-items-center pt-2 border-top mt-2">
                        <a href="{% url 'daftar_tugas' %}" class="btn btn-sm btn-outline-maroon rounded-pill px-3"
                            style="font-size: 0.7rem;">
                            Kelola Tugas <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% elif request.session.active_role == 'COMMANDER' %}
        <!-- VIEW COMMANDER -->
        <!-- Total Akun Medsos Commander -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <div>
                            <p class="text-muted fw-bold mb-1 small text-uppercase ls-1">{{ user_stats.label|default:"TOTAL AKUN" }}</p>
                            <h4 class="fw-bold text-dark mb-0">{{ user_stats.total|default:"0" }}</h4>
                        </div>
                        <div class="icon-box bg-maroon-soft text-maroon rounded-circle p-2 d-flex align-items-center justify-content-center"
                            style="width: 45px; height: 45px;">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>

                    <!-- Breakdown Platform -->
                    <div class="d-flex flex-wrap gap-2 mb-4">
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1 border shadow-sm">
                            <i class="fab fa-instagram text-danger me-2 small"></i>
                            <span class="fw-bold text-dark small">{{ user_stats.ig|default:"0" }}</span>
                        </div>
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1 border shadow-sm">
                            <i class="fab fa-tiktok text-dark me-2 small"></i>
                            <span class="fw-bold text-dark small">{{ user_stats.tt|default:"0" }}</span>
                        </div>
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-1 border shadow-sm">
                            <i class="fab fa-facebook text-primary me-2 small"></i>
                            <span class="fw-bold text-dark small">{{ user_stats.fb|default:"0" }}</span>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center pt-2 border-top">
                        <span class="badge bg-maroon-soft text-maroon rounded-pill px-2 py-1" style="font-size: 0.65rem;">
                            <i class="fas fa-users-cog me-1"></i> Monitoring Wilayah
                        </span>
                        <a href="{% url 'monitoring_akun_kader' %}" class="btn btn-sm btn-outline-maroon rounded-pill px-3"
                            style="font-size: 0.7rem;">
                            Selengkapnya <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Misi Wilayah Status -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 p-4">
                <div class="d-flex align-items-center justify-content-between mb-3">
                    <h6 class="fw-bold text-maroon text-uppercase mb-0 ls-1" style="font-size: 11px;">MISI WILAYAH</h6>
                    <span class="badge bg-light text-muted border rounded-pill">{{ today|date:"d M Y" }}</span>
                </div>
                <div class="text-center py-5">
                    <div class="icon-box bg-light rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                        <i class="fas fa-map-marked-alt text-muted fa-lg"></i>
                    </div>
                    <p class="text-muted small mb-0 italic" style="font-size: 0.75rem;">Saat ini belum ada misi khusus untuk wilayah Anda.</p>
                </div>
            </div>
        </div>

        {% elif request.session.active_role == 'CADRE' %}
        <!-- VIEW CADRE -->
        
        <!-- Alert Biodata & Akun Medsos -->
        <div class="col-12">
            {% if not biodata_lengkap %}
            <div class="alert alert-danger border-0 shadow-sm rounded-4 p-3 mb-3" role="alert">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-circle text-danger me-3" style="font-size: 1.2rem;"></i>
                    <div class="flex-grow-1">
                        <h6 class="fw-bold mb-1 text-uppercase ls-1" style="font-size: 0.8rem;">Lengkapi Biodata Anda!</h6>
                        <p class="mb-0" style="font-size: 0.75rem;">Anda belum melengkapi biodata Anda.</p>
                    </div>
                    <a href="{% url 'biodata_kader' %}" class="btn btn-light btn-sm rounded-pill px-3 ms-3 fw-bold" style="font-size: 0.75rem;">
                        <i class="fas fa-user-edit me-1"></i>Lengkapi
                    </a>
                </div>
            </div>
            {% endif %}
            
            {% if not has_verified_account %}
            <div class="alert alert-warning border-0 shadow-sm rounded-4 p-3 mb-3" role="alert">
                <div class="d-flex align-items-center">
                    <i class="fas fa-exclamation-triangle text-warning me-3" style="font-size: 1.2rem;"></i>
                    <div class="flex-grow-1">
                        <h6 class="fw-bold mb-1 text-uppercase ls-1" style="font-size: 0.8rem;">Daftar Akun Medsos Anda!</h6>
                        <p class="mb-0" style="font-size: 0.75rem;">Anda belum mendaftarkan akun media sosial.</p>
                    </div>
                    <a href="{% url 'akun_medsos_kader' %}" class="btn btn-light btn-sm rounded-pill px-3 ms-3 fw-bold" style="font-size: 0.75rem;">
                        <i class="fas fa-id-card me-1"></i>Daftar
                    </a>
                </div>
            </div>
            {% endif %}
        </div>
        
        <div class="col-12 col-md-4">
            <div class="card border-0 shadow-sm h-100 p-4 bg-maroon text-white"
                style="background-color: var(--primary-maroon) !important;">
                <p class="fw-bold text-uppercase opacity-75 mb-1" style="font-size: 0.7rem;">Poin Patriot Saya</p>
                <h3 class="fw-bold mb-0 mt-2">{{ total_poin|default:0 }}</h3>
                <div class="mt-3">
                    <small class="opacity-75" style="font-size: 0.75rem;">
                        <i class="fas fa-check-circle me-1"></i>{{ total_misi_selesai|default:0 }} Misi Selesai
                    </small>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-8">
            <div class="card border-0 shadow-sm h-100 p-4">
                <h6 class="fw-bold text-dark mb-3"><i class="fas fa-bolt text-warning me-2"></i>MISI TERSEDIA</h6>
                <div class="text-center py-5 bg-light rounded border border-dashed">
                    <p class="text-muted mb-0">Belum ada misi baru untuk Anda kerjakan.</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Style Helper untuk Background Soft -->
    <style>
        .bg-maroon-soft {
            background-color: rgba(128, 0, 0, 0.1);
        }

        .text-maroon {
            color: #800000;
        }

        .bg-danger-soft {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .bg-dark-soft {
            background-color: rgba(33, 37, 41, 0.1);
        }

        .bg-primary-soft {
            background-color: rgba(13, 110, 253, 0.1);
        }

        .bg-success-soft {
            background-color: rgba(25, 135, 84, 0.1);
        }

        .ls-1 {
            letter-spacing: 1px;
        }

        .btn-outline-maroon {
            color: #800000;
            border-color: #800000;
        }

        .btn-outline-maroon:hover {
            background-color: #800000;
            color: white;
        }
    </style>
    {% endblock %}

    {% block extra_js %}
    {% endblock %}