{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Dashboard - PATRIOT{% endblock %}

{% block body_class %}has-sidebar{% endblock %}

{% block sidebar %}
{% include 'layouts/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- alert info standar -->
    <div class="alert alert-info alert-dismissible fade show border-0 shadow-sm mb-4" role="alert">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle me-2"></i>
            <div>
                Selamat Datang, <strong>FARIS GERINDRA</strong> (DIGITAL COMMAND OFFICER).
            </div>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>

    <!-- Stats Cards -->
    <!-- Section Info -->
    <div class="mb-3">
        <h6 class="fw-bold text-maroon text-uppercase mb-0" style="letter-spacing: 1px; font-size: 12px;">
            {% if request.session.active_role == 'COMMANDER' %}
            Commander Command Center
            {% elif request.session.active_role == 'CADRE' %}
            Cadre Mission Hub
            {% else %}
            Dashboard DCO
            {% endif %}
        </h6>
    </div>
    <div class="row g-4 mb-4">
        {% if request.session.active_role == 'DCO' or not request.session.active_role %}
        <!-- VIEW DCO -->
        <!-- Total Konten + Rincian -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <div>
                            <p class="text-muted fw-bold mb-1 small text-uppercase ls-1">Total Konten</p>
                            <h3 class="fw-bold text-dark mb-0 display-5">{{ total_konten|default:"0" }}</h3>
                        </div>
                        <div class="icon-box bg-maroon-soft text-maroon rounded-circle p-3 d-flex align-items-center justify-content-center"
                            style="width: 60px; height: 60px;">
                            <i class="fas fa-layer-group fa-lg"></i>
                        </div>
                    </div>

                    <!-- Rincian Platform -->
                    <div class="d-flex gap-2 mb-4">
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-2 border shadow-sm">
                            <i class="fab fa-instagram text-danger me-2 fs-5"></i>
                            <span class="fw-bold text-dark fs-6">{{ total_ig|default:"0" }}</span>
                        </div>
                        <div class="d-flex align-items-center bg-light rounded-pill px-3 py-2 border shadow-sm">
                            <i class="fab fa-tiktok text-dark me-2 fs-5"></i>
                            <span class="fw-bold text-dark fs-6">{{ total_tt|default:"0" }}</span>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                        <span class="badge bg-success-soft text-success rounded-pill px-2 py-1 small">
                            <i class="fas fa-arrow-up me-1"></i> Update Terbaru
                        </span>
                        <a href="{% url 'daftar_konten' %}"
                            class="btn btn-sm btn-outline-maroon rounded-pill px-3 py-1 fw-bold"
                            style="font-size: 11px;">
                            Kelola Konten <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Status Operasi Harian -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <p class="text-muted fw-bold mb-1 small text-uppercase ls-1">Status Operasi</p>
                            <h5 class="fw-bold text-maroon mb-0">
                                <i class="far fa-calendar-alt me-2"></i>{{ today|date:"d F Y" }} <small
                                    class="text-muted ms-1" style="font-size: 0.7em;">
                                    ({{ today|date:"H:i" }} WIB)</small>
                            </h5>
                        </div>
                        <div class="icon-box bg-primary-soft text-primary rounded-circle p-3">
                            <i class="fas fa-bullseye fa-lg"></i>
                        </div>
                    </div>

                    <div class="border-top pt-3">
                        <h6 class="small fw-bold text-secondary mb-3">TUGAS AKTIF HARI INI:</h6>

                        <div class="d-flex flex-column gap-2" style="max-height: 120px; overflow-y: auto;">
                            {% for tugas in tugas_aktif_list %}
                            <div class="d-flex align-items-center bg-light p-2 rounded border">
                                <div class="me-2">
                                    {% if tugas.konten.platform == 'INSTAGRAM' %}
                                    <i class="fab fa-instagram text-danger"></i>
                                    {% elif tugas.konten.platform == 'TIKTOK' %}
                                    <i class="fab fa-tiktok text-dark"></i>
                                    {% else %}
                                    <i class="fas fa-share-alt text-secondary"></i>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1 text-truncate">
                                    <span class="small fw-bold text-dark d-block text-truncate">
                                        {{ tugas.konten.judul }}</span>
                                    <span class="badge bg-warning text-dark rounded-pill" style="font-size: 8px;">
                                        {{ tugas }}</span>
                                </div>
                                <div class="ms-2">
                                    <small class="text-secondary" style="font-size: 9px;">
                                        Exp: {{ tugas.tanggal_selesai|date:"d/m" }}</small>
                                </div>
                            </div>
                            {% empty %}
                            <div class="text-center py-3 text-muted border border-dashed rounded bg-light">
                                <small>Tidak ada misi aktif hari ini.</small>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="d-flex justify-content-end align-items-center pt-2 border-top mt-2">
                        <a href="{% url 'daftar_konten' %}" class="btn btn-sm btn-outline-maroon rounded-pill px-3"
                            style="font-size: 11px;">
                            Kelola Tugas <i class="fas fa-arrow-right ms-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% elif request.session.active_role == 'COMMANDER' %}
        <!-- VIEW COMMANDER -->
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 p-4">
                <div class="text-center py-5">
                    <i class="fas fa-user-shield fa-4x text-primary mb-3 opacity-25"></i>
                    <h5 class="fw-bold text-dark">Halo, COMMANDER!</h5>
                    <p class="text-muted small">Dashboard Anda sedang dalam persiapan operasional wilayah.</p>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="card border-0 shadow-sm h-100 p-4">
                <h6 class="fw-bold text-secondary border-bottom pb-2">MISI WILAYAH</h6>
                <div class="text-center py-4 text-muted small italic">Menunggu misi baru...</div>
            </div>
        </div>

        {% elif request.session.active_role == 'CADRE' %}
        <!-- VIEW CADRE -->
        <div class="col-12 col-md-4">
            <div class="card border-0 shadow-sm h-100 p-4 bg-maroon text-white"
                style="background-color: var(--primary-maroon) !important;">
                <p class="small fw-bold text-uppercase opacity-75 mb-1">Poin Patriot Saya</p>
                <h2 class="display-4 fw-bold">1,250</h2>
                <div class="mt-auto">
                    <span class="badge bg-white text-maroon rounded-pill">Peringkat #15</span>
                </div>
            </div>
        </div>
        <div class="col-12 col-md-8">
            <div class="card border-0 shadow-sm h-100 p-4">
                <h6 class="fw-bold text-dark mb-3"><i class="fas fa-bolt text-warning me-2"></i>MISI TERSEDIA</h6>
                <div class="text-center py-5 bg-light rounded border border-dashed">
                    <p class="text-muted mb-0">Belum ada misi baru untuk Anda kerjakan.</p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Style Helper untuk Background Soft -->
    <style>
        .bg-maroon-soft {
            background-color: rgba(128, 0, 0, 0.1);
        }

        .text-maroon {
            color: #800000;
        }

        .bg-danger-soft {
            background-color: rgba(220, 53, 69, 0.1);
        }

        .bg-dark-soft {
            background-color: rgba(33, 37, 41, 0.1);
        }

        .bg-primary-soft {
            background-color: rgba(13, 110, 253, 0.1);
        }

        .bg-success-soft {
            background-color: rgba(25, 135, 84, 0.1);
        }

        .ls-1 {
            letter-spacing: 1px;
        }

        .btn-outline-maroon {
            color: #800000;
            border-color: #800000;
        }

        .btn-outline-maroon:hover {
            background-color: #800000;
            color: white;
        }
    </style>
    {% endblock %}

    {% block extra_js %}
    {% endblock %}