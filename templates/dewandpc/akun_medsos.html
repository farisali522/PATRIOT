{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Manajemen Akun Medsos - PATRIOT{% endblock %}

{% block body_class %}has-sidebar{% endblock %}

{% block sidebar %}
{% include 'layouts/sidebar.html' %}
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    {% if messages %}
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show border-0 shadow-sm rounded-4 mb-4"
        role="alert">
        <i class="fas fa-check-circle me-2"></i> {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
    {% endif %}
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h5 class="fw-bold mb-0 text-maroon ls-1">MANAJEMEN AKUN MEDSOS</h5>
            <p class="text-muted small mb-0">Kelola dan pantau aset media sosial wilayah.</p>
        </div>
        <button class="btn btn-maroon btn-sm px-3 shadow-sm rounded-pill" data-bs-toggle="modal"
            data-bs-target="#modalTambahAkun">
            <i class="fas fa-plus me-2"></i>Tambah Akun
        </button>
    </div>

    <!-- Info Alert -->
    <div class="row g-4 mb-4">
        <div class="col-12 col-md-6">
            <div class="alert alert-info border-0 shadow-sm rounded-4 p-3 h-100 mb-0 alert-dismissible fade show"
                role="alert">
                <div class="d-flex me-4">
                    <i class="fas fa-id-card-alt fa-lg text-info me-3 mt-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1 small text-uppercase ls-1">Verifikasi Akun Saya</h6>
                        <p class="small mb-0 text-dark opacity-75">Akun yang Anda daftarkan akan diperiksa oleh tim DCO
                            Pusat untuk memastikan validitas aset wilayah.</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
        <div class="col-12 col-md-6">
            <div class="alert alert-success border-0 shadow-sm rounded-4 p-3 h-100 mb-0 alert-dismissible fade show"
                role="alert">
                <div class="d-flex me-4">
                    <i class="fas fa-users-cog fa-lg text-success me-3 mt-1"></i>
                    <div>
                        <h6 class="fw-bold mb-1 small text-uppercase ls-1">Monitoring Cadre</h6>
                        <p class="small mb-0 text-dark opacity-75">Pantau keaktifan dan status verifikasi akun medsos
                            milik seluruh Pasukan (Cadre) di bawah komando Anda.</p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    </div>

    <!-- Statistik Ringkas -->
    <div class="row g-3 mb-4">
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm rounded-3 p-3">
                <small class="text-muted fw-bold d-block mb-1">TOTAL AKUN</small>
                <h4 class="fw-bold mb-0">{{ stats.total|default:"0" }}</h4>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm rounded-3 p-3 border-start border-danger border-4">
                <small class="text-muted fw-bold d-block mb-1">INSTAGRAM</small>
                <h4 class="fw-bold mb-0 text-danger">{{ stats.ig|default:"0" }}</h4>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm rounded-3 p-3 border-start border-dark border-4">
                <small class="text-muted fw-bold d-block mb-1">TIKTOK</small>
                <h4 class="fw-bold mb-0 text-dark">{{ stats.tt|default:"0" }}</h4>
            </div>
        </div>
        <div class="col-6 col-md-3">
            <div class="card border-0 shadow-sm rounded-3 p-3 border-start border-primary border-4">
                <small class="text-muted fw-bold d-block mb-1">FACEBOOK</small>
                <h4 class="fw-bold mb-0 text-primary">{{ stats.fb|default:"0" }}</h4>
            </div>
        </div>
    </div>

    <!-- Tabel Akun -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-5">
        <div class="card-header bg-white border-0 py-3 px-4 d-flex align-items-center">
            <h6 class="fw-bold mb-0 text-dark small"><i class="fas fa-id-card-alt text-maroon me-2"></i>AKUN SAYA
                (COMMANDER)</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">PLATFORM</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">USERNAME</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">KATEGORI</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">STATUS</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0 text-end">AKSI</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for akun in akun_list %}
                        <tr>
                            <td class="px-4 py-3">
                                <i class="fab fa-{{ akun.get_platform_display|lower }} text-maroon fs-5"></i>
                                <span class="ms-2 small">{{ akun.get_platform_display }}</span>
                            </td>
                            <td class="px-4 py-3">
                                <div class="fw-bold text-dark">{{ akun.username }}</div>
                                <a href="{{ akun.link_profil }}" target="_blank"
                                    class="text-muted small text-decoration-none">Lihat Profil <i
                                        class="fas fa-external-link-alt ms-1" style="font-size: 0.8em;"></i></a>
                            </td>
                            <td class="px-4 py-3">
                                <span class="badge bg-primary-soft text-primary rounded-pill">Aset wilayah</span>
                            </td>
                            <td class="px-4 py-3">
                                {% if akun.status == 'PENDING' %}
                                <span class="badge bg-warning text-dark rounded-pill px-3"><i
                                        class="fas fa-clock me-1"></i>Menunggu Verifikasi</span>
                                {% elif akun.status == 'VERIFIED' %}
                                <span class="badge bg-success rounded-pill px-3"><i
                                        class="fas fa-check me-1"></i>Terverifikasi</span>
                                {% else %}
                                <span class="badge bg-danger rounded-pill px-3"><i
                                        class="fas fa-times me-1"></i>Ditolak</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 text-end">
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-light rounded-circle" data-bs-toggle="dropdown">
                                        <i class="fas fa-ellipsis-v text-muted"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                                        <li><a class="dropdown-item py-2 small" href="#"><i
                                                    class="fas fa-edit me-2"></i>Edit</a></li>
                                        <li><a class="dropdown-item py-2 small text-danger" href="#"><i
                                                    class="fas fa-trash me-2"></i>Hapus</a></li>
                                    </ul>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <i class="fas fa-id-card-alt fa-3x text-light mb-3"></i>
                                <p class="text-muted mb-0">Bos belum mendaftarkan akun media sosial.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Tabel Akun Cadre (Subordinates) -->
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
        <div class="card-header bg-white border-0 py-3 px-4 d-flex align-items-center">
            <h6 class="fw-bold mb-0 text-dark small"><i class="fas fa-users text-primary me-2"></i>MONITORING AKUN CADRE
                (BAWAHAN)</h6>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">CADRE</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">PLATFORM</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">USERNAME</th>
                            <th class="px-4 py-3 text-secondary small fw-bold border-0">STATUS</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for akun in akun_cadre_list %}
                        <tr>
                            <td class="px-4 py-3">
                                <div class="fw-bold text-dark">{{ akun.owner.username }}</div>
                                <span class="text-muted small">Anggota Wilayah</span>
                            </td>
                            <td class="px-4 py-3">
                                <i class="fab fa-{{ akun.get_platform_display|lower }} text-primary fs-5"></i>
                                <span class="ms-2 small">{{ akun.get_platform_display }}</span>
                            </td>
                            <td class="px-4 py-3">
                                <div class="fw-bold text-dark">{{ akun.username }}</div>
                                <a href="{{ akun.link_profil }}" target="_blank"
                                    class="text-primary small text-decoration-none">Lihat Profil <i
                                        class="fas fa-external-link-alt ms-1" style="font-size: 0.8em;"></i></a>
                            </td>
                            <td class="px-4 py-3">
                                {% if akun.status == 'PENDING' %}
                                <span class="badge bg-warning text-dark rounded-pill px-3">Proses Verifikasi</span>
                                {% elif akun.status == 'VERIFIED' %}
                                <span class="badge bg-success rounded-pill px-3">Terverifikasi</span>
                                {% else %}
                                <span class="badge bg-danger rounded-pill px-3">Ditolak</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="4" class="text-center py-5">
                                <i class="fas fa-users-slash fa-3x text-light mb-3"></i>
                                <p class="text-muted mb-0">Belum ada data akun Cadre bawahan yang terdaftar.</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal Tambah Akun (Placeholder) -->
<div class="modal fade" id="modalTambahAkun" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow rounded-4 text-dark">
            <div class="modal-header border-0 pb-0 px-4 pt-4">
                <h5 class="modal-title fw-bold text-maroon">TAMBAH AKUN</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body p-4">
                <form method="POST">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Platform</label>
                        <select name="platform" class="form-select rounded-3">
                            <option value="INSTAGRAM">Instagram</option>
                            <option value="TIKTOK">TikTok</option>
                            <option value="FACEBOOK">Facebook</option>
                            <option value="TWITTER">Twitter (X)</option>
                            <option value="YOUTUBE">YouTube</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Username</label>
                        <div class="input-group">
                            <span
                                class="input-group-text bg-light border-end-0 rounded-start-3 fw-bold text-muted">@</span>
                            <input type="text" name="username" class="form-control border-start-0 rounded-end-3"
                                placeholder="namapengguna" required>
                        </div>
                        <div class="form-text" style="font-size: 0.75rem;">Cukup masukkan nama, link profil akan dibuat
                            otomatis.</div>
                    </div>
                    <div class="text-end pt-3">
                        <button type="button" class="btn btn-light rounded-pill px-4 me-2"
                            data-bs-dismiss="modal">Batal</button>
                        <button type="submit" class="btn btn-maroon rounded-pill px-4">Simpan Akun</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
    .text-maroon {
        color: #800000;
    }

    .ls-1 {
        letter-spacing: 1px;
    }

    .bg-maroon {
        background-color: #800000;
        color: white;
    }

    .btn-maroon {
        background-color: #800000;
        color: white;
        border: none;
    }

    .btn-maroon:hover {
        background-color: #600000;
        color: white;
    }

    .bg-primary-soft {
        background-color: rgba(13, 110, 253, 0.1);
    }

    .bg-info-soft {
        background-color: rgba(13, 202, 240, 0.1);
    }
</style>
{% endblock %}